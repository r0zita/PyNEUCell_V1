# PyNEUCell_V1

PyNEUCell is a Python framework for coupling NEURON electrophysiology with MCell4 reaction–diffusion simulations to model nerve terminal function for the mouse neuromuscular junction (NMJ).

---

## Overview

Here we use **physiologically realistic, dynamically changing action potentials** to control molecular simulations, enabling a tight coupling between membrane electrophysiology and stochastic chemical dynamics.

The current reference implementation models the **mouse neuromuscular junction (NMJ)**, where precise spike timing and waveform shape critically influence synaptic transmission.  
While the present models focus on the mouse NMJ, the framework itself is **species-agnostic** and designed to be extended to other synaptic systems.

---

## Repository Structure

```text
.
├── model.py              # Main entry point
├── parameters.py         # Global parameters and constants
├── shared.py             # Shared utilities and helpers
├── instantiation.py      # Object and species instantiation
├── subsystem.py          # Reaction–diffusion subsystem definitions
├── customization.py      # Simulation-specific customization hooks
├── observables.py        # Output definitions and observables
│
├── geometry/             # MCell geometry files
└── NEURON_RATES/         # Precomputed NEURON-derived rate tables
```

## Ion Channel Model

The presynaptic active zone is modeled using an explicit, state-based description of voltage-gated calcium channels (VGCCs) and calcium-activated potassium (SK) channels.

### Active Zone Organization

- **6 active zones**
- Each active zone contains:
  - **4 voltage-gated calcium channels (VGCCs)**
  - **4 SK channels**
  - **2 docked synaptic vesicles**

All channels are immobile and confined to the presynaptic membrane.

---

### Voltage-Gated Calcium Channels (VGCCs)

Each VGCC is represented by a multi-state Markov model with the following membrane-bound states:

- `closed`
- `closed2`
- `closed3`
- `open1`
- `open2`

State transitions between closed and open states are governed by **time-dependent rate functions** derived from NEURON-simulated action potentials.

#### Gating Transitions

For each active zone and channel, the following transitions are defined:

- `closed ⇄ closed2`
- `closed2 ⇄ closed3`
- `closed3 ⇄ open1`
- `open1 ⇄ open2`

Transitions among closed states and the initial opening transition are controlled by **NEURON-derived variable rates**, while transitions between open states use fixed rate constants.

---

### Action Potential–Driven Calcium Release

Calcium entry occurs when a VGCC is in an open state (`open1` or `open2`).  
Each action potential waveform produces a **distinct calcium species**, allowing multiple spikes to be tracked independently.

For each channel and action potential index:

- `open → open + Ca²⁺`

Calcium release rates are **time-varying** and are read from precomputed NEURON rate tables stored in `NEURON_RATES/`.

This design allows realistic action potential waveforms—not square pulses—to directly control calcium influx.

---

### SK (Small-Conductance Potassium) Channels

Each active zone also contains **4 SK channels**, positioned with a small lateral offset from the corresponding VGCCs.

SK channels are modeled using a calcium-dependent gating scheme with the following states:

- `closed`
- `closed2`
- `closed3`
- `closed4`
- `open1`
- `open2`

#### Calcium-Dependent Gating

SK channel activation is driven by local calcium concentration:

- Forward transitions between closed states require calcium binding
- Reverse transitions release calcium back into the local pool

This allows SK channels to respond dynamically to calcium microdomains generated by nearby VGCCs.

#### Calcium-Independent Gating

Final transitions between closed and open states are calcium-independent and governed by fixed rate constants.

---

### Functional Coupling

Together, VGCCs and SK channels form a tightly coupled system in which:

- Action potentials control VGCC gating and calcium entry
- Local calcium activates SK channels
- SK channel opening provides feedback regulation of excitability

This channel model enables realistic simulation of spike-driven calcium dynamics and local feedback at the neuromuscular junction.

## SK Channel Kinetics and Rate Constants

The calcium-dependent gating of SK (small-conductance Ca²⁺-activated K⁺) channels is modeled using a multi-state kinetic scheme derived from experimental measurements of recombinant SK channels.

The reaction scheme and rate constants are based on:

Hirschberg B, Maylie J, Adelman JP, Marrion NV.  
Gating of recombinant small-conductance Ca-activated K⁺ channels by calcium.  
*Journal of General Physiology*, 111(4):565–581, 1998.  
DOI: 10.1085/jgp.111.4.565



### Calcium-Dependent Transitions

Forward transitions between closed states are calcium-dependent and modeled as second-order reactions:

- `closed  + Ca²⁺ → closed2`
- `closed2 + Ca²⁺ → closed3`
- `closed3 + Ca²⁺ → closed4`

Reverse transitions release calcium back into the local pool:

- `closed2 → closed  + Ca²⁺`
- `closed3 → closed2 + Ca²⁺`
- `closed4 → closed3 + Ca²⁺`

---

### Rate Constants

Calcium-dependent forward rates:

- `k(c1 → c2) = 2.0 × 10⁸ M⁻¹ s⁻¹`
- `k(c2 → c3) = 1.6 × 10⁸ M⁻¹ s⁻¹`
- `k(c3 → c4) = 8.0 × 10⁷ M⁻¹ s⁻¹`

Calcium-independent reverse rates:

- `k(c2 → c1) = 80 s⁻¹`
- `k(c3 → c2) = 80 s⁻¹`
- `k(c4 → c3) = 200 s⁻¹`

---

### Calcium-Independent Gating Transitions

Final opening and closing transitions are calcium-independent:

- `closed3 ⇄ open1`
- `closed4 ⇄ open2`

With fixed rate constants:

- `k(c3 → o1) = 160 s⁻¹`
- `k(o1 → c3) = 1000 s⁻¹`
- `k(c4 → o2) = 1200 s⁻¹`
- `k(o2 → c4) = 100 s⁻¹`


Compact SK Channel Reaction Diagram
Calcium-dependent SK channel gating scheme:

C1–C4 : closed states with sequential Ca²⁺ binding
O1,O2 : conducting open states

• Forward C → C transitions require Ca²⁺ binding
• Reverse transitions release Ca²⁺
• Final opening/closing steps are Ca²⁺-independent

Methods: SK Channel Model

Small-conductance calcium-activated potassium (SK) channels were modeled using a multi-state kinetic scheme based on experimentally measured calcium-dependent gating of recombinant SK channels (Hirschberg et al., 1998). Each SK channel was represented by four closed states and two open states. Sequential calcium binding drives transitions between closed states, while reverse transitions release calcium back into the local pool. Calcium-dependent forward transitions were implemented as second-order reactions with rate constants converted to MCell-compatible units. Final transitions between closed and open states were calcium-independent and governed by fixed rate constants.

This kinetic scheme allows SK channels to integrate local calcium microdomains generated by nearby voltage-gated calcium channels, producing rapid calcium-dependent activation and providing negative feedback regulation of presynaptic excitability.
